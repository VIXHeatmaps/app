<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Heatmap Viewer</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
    body { font-family: sans-serif; margin: 20px; }
    h2 { margin-bottom: 5px; }
    .formula { font-style: italic; margin-bottom: 20px; }
    .header { display: flex; justify-content: space-between; align-items: flex-start; }
    .controls, .upload-box { flex: 1; }
    .upload-box { max-width: 300px; border: 1px solid #ccc; padding: 10px; border-radius: 6px; }
    .control { margin-bottom: 12px; }
    label { font-weight: bold; margin-right: 6px; }
    select, input[type="number"], input[type="text"] { vertical-align: middle; }
    input[type="range"] { width: 200px; vertical-align: middle; }
    .switch { position: relative; display: inline-block; width: 40px; height: 20px; margin: 0 6px; vertical-align: middle; }
    .switch input { opacity: 0; width: 0; height: 0; }
    .slider { position: absolute; cursor: pointer; top:0; left:0; right:0; bottom:0; background:#ccc; transition:.4s; border-radius:20px; }
    .slider:before { position:absolute; content:""; height:16px; width:16px; left:2px; bottom:2px; background:white; transition:.4s; border-radius:50%; }
    input:checked + .slider { background: #4CAF50; }
    input:checked + .slider:before { transform: translateX(20px); }
    #edgeContainer { display: flex; align-items: stretch; margin-top: 20px; }
    #hoverY { width: 80px; text-align: right; padding-right: 10px; }
    #heatmap { flex:1; }
    #hoverX-container { display: flex; justify-content: center; margin-top: 8px; }
    #hoverX { font-style: italic; }
  </style>
</head>
<body>

  <!-- 1. Title & formula :contentReference[oaicite:1]{index=1} -->
  <h2>Heatmap Viewer</h2>
  <div class="formula">
    <strong>Metric:</strong> H = (AR – AR<sub>min</sub>) / max(MD, MD<sub>min</sub>) (decimal)
  </div>

  <div class="header">
    <!-- 6. Left panel: Metric Controls :contentReference[oaicite:2]{index=2} -->
    <div class="controls">
      <div class="control">
        <label for="symbolSelect">Symbol:</label>
        <select id="symbolSelect"></select>
        <span id="sourceLabel">(Data Source: <strong id="sourceName">Exxahub</strong>)</span>
      </div>
      <div class="control">
        <label for="arFloor">AR Min. (%):</label>
        <input type="range" id="arFloor" min="0" max="100" step="0.1" value="1">
        <input type="number" id="arFloorNum" min="0" max="100" step="0.1" value="1">
      </div>
      <div class="control">
        <label for="mdMin">MD Min. (%):</label>
        <input type="range" id="mdMin" min="0" max="100" step="0.1" value="3">
        <input type="number" id="mdMinNum" min="0" max="100" step="0.1" value="3">
      </div>
      <div class="control">
        <label for="mdCeil">MD Ceiling (%):</label>
        <input type="range" id="mdCeil" min="0" max="100" step="0.1" value="25">
        <input type="number" id="mdCeilNum" min="0" max="100" step="0.1" value="25">
      </div>
      <div class="control">
        <label for="zMin">Colorbar Min H:</label>
        <input type="number" id="zMin" step="0.01" value="-1">
        <label for="zMax">Max H:</label>
        <input type="number" id="zMax" step="0.01" value="1">
        <span id="currentMaxH">Current Max H: --</span>
      </div>
    </div>

    <!-- 3–5. Right panel: Upload, Data Source & Conversion Toggle :contentReference[oaicite:3]{index=3} -->
    <div class="upload-box">
      <div class="control">
        <label for="csvInput">Upload CSV:</label>
        <input type="file" id="csvInput" accept=".csv">
      </div>
      <div class="control">
        <label for="dataSource">Data Source:</label>
        <select id="dataSource">
          <option>Exxahub</option>
          <option>QuantMage</option>
          <option>Composer</option>
          <option>Testfol.io</option>
          <option>Other</option>
          <option selected>Unknown</option>
        </select>
        <input type="text" id="customSource" placeholder="Custom source" style="display:none; margin-top:4px; width: 100%;">
      </div>
      <div class="control">
        <label>Convert Data:</label>
        <span>×0.01</span>
        <label class="switch">
          <input type="checkbox" id="percentToggle" checked>
          <span class="slider"></span>
        </label>
        <span>×100</span>
      </div>
      <div class="control">
        <button id="exportBtn">Export Data CSV</button>
      </div>
    </div>
  </div>

  <!-- 7. Heatmap & 8. Hover panels :contentReference[oaicite:4]{index=4} -->
  <div id="edgeContainer">
    <div id="hoverY"></div>
    <div id="heatmap"></div>
  </div>
  <div id="hoverX-container">
    <div id="hoverX"></div>
  </div>

  <script>
    // JavaScript stubs for:
    // - populating symbolSelect from CSVs
    // - showing/hiding #customSource when "Other" is picked
    // - reading AR/MD synonyms on parse
    // - applying conversion toggle
    // - drawing Plotly heatmap with z-range, colorscale, MD ceiling overlay
    // - updating hoverX / hoverY on mousemove
    // - exporting combined allData → CSV
  </script>
</body>
</html>
